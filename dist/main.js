(()=>{"use strict";const e=document.getElementById("tpl-char"),t=({description:t,shortDescription:n,name:d,image:a})=>{const c=document.getElementById("card__target");let i=e.content.cloneNode(!0);i.querySelector(".card__name").innerHTML=d,i.querySelector(".card__img").src=`data:image/png;base64, ${a}`,i.querySelector(".card__desc").innerHTML=t,i.querySelector(".card__shortDesc").innerHTML=n,c.append(i)},n=()=>{const e=document.querySelectorAll(".description-btn");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(()=>{"btn-bold"==e[t].id?(e[t].classList.toggle("active"),e[t].matches(".active")?document.getElementById("description").value=document.getElementById("description").value+"<strong>":document.getElementById("description").value=document.getElementById("description").value+"</strong>"):"btn-italic"==e[t].id?(e[t].classList.toggle("active"),e[t].matches(".active")?document.getElementById("description").value=document.getElementById("description").value+"<em>":document.getElementById("description").value=document.getElementById("description").value+"</em>"):"btn-strike"==e[t].id?(e[t].classList.toggle("active"),e[t].matches(".active")?document.getElementById("description").value=document.getElementById("description").value+"<strike>":document.getElementById("description").value=document.getElementById("description").value+"</strike>"):"btn-ul"==e[t].id?(e[t].classList.toggle("active"),e[t].matches(".active")?document.getElementById("description").value=document.getElementById("description").value+"<ul><li>":document.getElementById("description").value=document.getElementById("description").value+"</li></ul>"):"btn-ol"==e[t].id?(e[t].classList.toggle("active"),e[t].matches(".active")?document.getElementById("description").value=document.getElementById("description").value+"<ol><li>":document.getElementById("description").value=document.getElementById("description").value+"</li></ol>"):"btn-quote"==e[t].id?(e[t].classList.toggle("active"),e[t].matches(".active")?document.getElementById("description").value=document.getElementById("description").value+"<q>":document.getElementById("description").value=document.getElementById("description").value+"</q>"):getVisuOnTextDesc()}))},d=()=>{let e=document.getElementById("description-visu"),t=document.getElementById("description-div-visu");e.addEventListener("click",(()=>{let n=document.getElementById("description").value;t.classList.toggle("hidden"),e.classList.toggle("active"),e.classList.contains("active")&&(t.innerHTML=n,e.addEventListener("click",(()=>{t.classList.toggle("hidden"),e.classList.toggle("active")})))}))},a=(e,t,n)=>{let d=document.getElementById(e);console.log(d);let a=d.value.length;document.querySelectorAll(".input-char-count")[n].innerHTML=`${a} on max ${t} char.`,d.addEventListener("input",(()=>{let d=document.getElementById(e),a=d.value.length;d.maxLength=t,console.log(a,d),document.querySelectorAll(".input-char-count")[n].innerHTML=`${a} on max ${t} char.`}))},c=document.getElementById("modal-container"),i=document.getElementById("addChar-close"),o=document.getElementById("modChar-close"),s=(document.getElementById("card__target"),async()=>{const e=await document.getElementsByClassName("btn-modChar"),t=await Array.from(e);for(let e=0;e<t.length;e++)t[e].addEventListener("click",(async()=>{document.getElementById("modal-modChar").classList.remove("hidden"),c.classList.remove("hidden");let t=await fetch("https://character-database.becode.xyz/characters"),s=await t.json();document.getElementById("mod-image").src=`data:image/png;base64, ${s[e].image}`,document.getElementById("mod-name").innerHTML=s[e].name,document.getElementById("mod-shortDescription").innerHTML=s[e].shortDescription,document.getElementById("mod-description").innerHTML=s[e].description,document.getElementById("btn-mod").addEventListener("click",(async()=>{n();let t=Array.from(document.getElementsByTagName("input"));document.getElementById("modal-modChar").classList.add("hidden"),t[0].value="",preview.src=`data:image/png;base64, ${s[e].image}`,t[1].value=s[e].name,t[2].value=s[e].shortDescription,t[3].value=s[e].description,await t[0].addEventListener("change",(async e=>{const t=e.target.files[0];url=await readURL(t),preview.src=url})),document.getElementById("modal-addChar").classList.remove("hidden"),a("name",20,0),a("origin",70,1),a("description",350,2),d(),document.getElementById("btn-save").addEventListener("click",(async()=>{try{let n=t[1].value,d=t[2].value,a=t[3].value,c="",i=s[e].image,o=document.getElementById("preview").src;(i=!o)?(console.log(i,o.split(",")[1]),await fetch(`https://character-database.becode.xyz/characters/${s[e].id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:a,shortDescription:d,id:c,name:n,image:i})})):(i=o.split(",")[1],await fetch(`https://character-database.becode.xyz/characters/${s[e].id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:a,shortDescription:d,id:c,name:n,image:i})}))}catch(e){console.log(e)}})),i.addEventListener("click",(()=>{c.classList.add("hidden"),document.getElementById("modal-addChar").classList.add("hidden")}))})),document.getElementById("btn-mod-delete").addEventListener("click",(async()=>{await fetch(`https://character-database.becode.xyz/characters/${s[e].id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})})),o.addEventListener("click",(()=>{c.classList.add("hidden"),document.getElementById("modal-modChar").classList.add("hidden")}))}))}),l=document.getElementById("modal-container"),r=document.getElementById("addChar-close"),m=(document.getElementById("modChar-close"),document.getElementById("card__target"));let u=document.getElementById("search");var g="";document.getElementById("search-form").addEventListener("submit",(e=>{e.preventDefault()})),window.onload=async function(){let e="";try{let n=await fetch("https://character-database.becode.xyz/characters");e=await n.json(),""==u.value&&e.forEach((({description:e,shortDescription:n,id:d,name:a,image:c})=>{t({description:e,shortDescription:n,id:d,name:a,image:c})}))}catch(e){console.log(e)}u.addEventListener("input",(async()=>{let n=e.filter((e=>(console.log(e.name.toLowerCase().includes(u.value.toLowerCase())),e.name.toLowerCase().includes(u.value.toLowerCase()))));console.log(n),(e=>{const t=document.getElementById("card__target");length=e.length,length<4?t.style.justifyContent="center":t.style.justifyContent="space-between"})(n),m.innerHTML="",n.forEach((({description:e,shortDescription:n,id:d,name:a,image:c})=>{t({description:e,shortDescription:n,id:d,name:a,image:c})}))})),setTimeout((()=>{s()}),500)},document.getElementById("addChar").addEventListener("click",(async()=>{l.classList.remove("hidden"),document.getElementById("modal-addChar").classList.remove("hidden"),n(),document.getElementById("image");let e=document.getElementById("preview"),t=Array.from(document.getElementsByTagName("input"));await t[0].addEventListener("change",(async t=>{const n=t.target.files[0];g=await(e=>new Promise(((t,n)=>{const d=new FileReader;d.onload=e=>t(e.target.result),d.onerror=e=>n(e),d.readAsDataURL(e)})))(n),e.src=g})),document.getElementById("btn-save").addEventListener("click",(async()=>{try{let e=t[1].value,n=t[2].value,d=t[3].value,a="",c=g.split(",")[1];await fetch("https://character-database.becode.xyz/characters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:d,shortDescription:n,id:a,name:e,image:c})})}catch(e){console.log(e)}})),document.getElementById("btn-delete").addEventListener("click",(()=>{t[0].value="",t[1].value="",t[2].value="",t[3].value="",document.getElementById("preview").src="a"})),r.addEventListener("click",(()=>{l.classList.add("hidden"),document.getElementById("modal-addChar").classList.add("hidden")}))}))})();